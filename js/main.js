!function e(i,a,l){function s(t,d){if(!a[t]){if(!i[t]){var r="function"==typeof require&&require;if(!d&&r)return r(t,!0);if(n)return n(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var c=a[t]={exports:{}};i[t][0].call(c.exports,function(e){var a=i[t][1][e];return s(a?a:e)},c,c.exports,e,i,a,l)}return a[t].exports}for(var n="function"==typeof require&&require,t=0;t<l.length;t++)s(l[t]);return s}({1:[function(e,i,a){"use strict";var l=e("./weeks");$(window).ready(function(){$("#handle-size-select").on("change",function(){(0,l.setHandleSize)(this.value)}),$("#calculate-all").on("click",function(){(0,l.calculateAllHandles)()});var e=!1,i=void 0;$(".on-btn").click(function(){if("none"==(i=document.getElementById("box").style.display)){if(document.getElementById("box").style.display="block",!e){e=!0,$(".flexslider").flexslider({animation:"slide",slideshow:!1,controlNav:!1,controlsContainer:$(".custom-controls-container"),customDirectionNav:$(".custom-navigation a"),keyboard:!1,animationLoop:!0,after:function(e){e.currentSlide==e.last&&(0,l.addLastWeekSlide)($(".flexslider")),(0,l.setWeekText)(e.currentSlide),0==e.currentSlide?($(".flex-prev").hide(),$(".flex-prev-block").show()):($(".flex-prev").show(),$(".flex-prev-block").hide())}});var a=moment().isoWeekday(),s=void 0;switch(a){case 1:s=".monday";break;case 2:s=".tuesday";break;case 3:s=".wednesday";break;case 4:s=".thursday";break;case 5:s=".friday";break;case 6:s=".saturday";break;case 7:s=".sunday"}var n=$(".flex-active-slide").find(s),t=$(".flex-active-slide .default-wrap > div"),d=t.splice(0,t.index(n));d.forEach(function(e){$(e).addClass("past-day")}),(0,l.initFirstSlider)(n)}}else"block"==i&&(document.getElementById("box").style.display="none")}),$(".close-button").click(function(){document.getElementById("box").style.display="none"}),$(".switch-on").click(l.daytimeSliderChanges),$(".switch-off").click(l.daytimeSliderChanges),$(".flex-prev").hide(),$(".flex-prev-block").show(),$(".add-button").click(function(){var e=$(".flex-active-slide .default-wrap > div:not(.past-day)"),i=e[0];(0,l.addHandle)(i)});var a=null;$(".del-button").mousedown(function(){a=$(":focus").hasClass("ui-slider-handle")?$(":focus"):null}),$(".del-button").click(function(){a&&(0,l.deleteHandle)(a)})})},{"./weeks":2}],2:[function(e,i,a){"use strict";function l(e){if(Array.isArray(e)){for(var i=0,a=Array(e.length);i<e.length;i++)a[i]=e[i];return a}return Array.from(e)}function s(e){var i=e.getBoundingClientRect();return{top:i.top+window.scrollY,bottom:i.bottom+window.scrollY,left:i.left+window.scrollX,right:i.right+window.scrollX}}function n(e){console.log(e),A=e,t()}function t(){var e;100==A?e="8px":200==A?e="16px":300==A?e="24px":400==A?e="32px":(console.log("incorrect HANDLE_SIZE value!"),e="8px"),$(".ui-slider-handle").css("height",e)}function d(e,i){return i&&(e=e.filter(function(e){return e<=14&&e>=4})),e}function r(e){var i=23-(moment().hour()+1);return i<0&&(i=0),e&&(i<4?i=4:i>14&&(i=14)),i}function o(e,i){var a;a=e.hasClass("current-day")?r(H):H?14:23,i=i?d(i,H):[a],e.slider({orientation:"vertical",min:H?4:0,max:H?14:23,values:i,step:1,animate:!0,start:function(e,i){var a=23-i.value;C.text(a),C.show(),C.css("top",s(i.handle).top-10),C.css("left",s(i.handle).left+30)},slide:function(e,i){if($(this).hasClass("current-day")&&!v(i))return!1;var a=s(this);if(!(e.pageX<a.right+10&&e.pageX>a.left-10&&e.pageY<a.bottom+10&&e.pageY>a.top-10))return!1;for(var l=[],n=0;n<i.values.length;n++){if(l.indexOf(i.values[n])>-1)return!1;l.push(i.values[n])}var t=23-i.value;C.text(t),C.css("top",s(i.handle).top-10),C.css("left",s(i.handle).left+30)},stop:function(){C.hide()}}),0==i.length?e.removeClass("active-slider"):e.addClass("active-slider"),p(),t()}function c(e){if(e.addClass("current-day"),r(H)>=23-S){var i=u(e,!0);o($(i))}else o(e)}function u(e,i){var a,l=$(".flex-active-slide .default-wrap > div"),s=l.index(e);if(6!=s)a=l[s+1];else{var n=$(".flex-active-slide")[0],t=n.nextElementSibling;a=$(t).find(".monday"),i&&f()}return a}function f(){$(".flex-next").trigger("click")}function v(e){return e.value<23-S}function p(){$(".ui-slider-handle").off("mousedown"),$(".ui-slider-handle").on("mousedown",function(e){function i(){$(".flex-active-slide .scale-item .default-wrap").off("mouseup")}function a(e){$(l).focus();var i=s(n);e.pageX<i.right+10&&e.pageX>i.left-10&&e.pageY<i.bottom+10&&e.pageY>i.top-10?r.css("display","none"):(r.css("display","initial"),r.css("left",e.pageX-r.width()/2),r.css("top",e.pageY-r.height()/2))}var l=this;$(l).focus();var n=$(this).parent()[0],t=$(n).find(".ui-slider-handle").index(l),d=$(".flex-active-slide .scale-item .default-wrap > div").index($(n)),r=$(this).clone().addClass("handle-clone");r.css("width",$(l).width()).css("height",$(l).height()),a(e),$("body").append(r),function(){$(".flex-active-slide .scale-item .default-wrap").each(function(e,i){e!==d&&$(i).mouseup(function(e){var i=$(e.currentTarget).find("div");m(e,n,i,t)})})}(),$("body").mousemove(function(e){a(e)}),$("body").mouseup(function(e){$("body").off("mousemove"),$("body").off("mouseup"),r.remove(),i()})})}function m(e,i,a,l){if(!a.hasClass("past-day")){if(a.hasClass("current-day")){if(r(H)>=23-S)return}var s=$(i).slider("values");s.splice(l,1);x(a,!0)&&($(i).slider("destroy"),o($(i),s)),C.hide()}}function h(){return $(".flexslider .slides .item:not(.clone)")}function y(e){var i=e.data("flexslider"),a=$('<li class="item">\n                                <div class="item-week">\n                                </div>\n                                <div class="scale-wrapper">\n                                    <ul class="list-scale-wrap">\n                                        <li class="times-wrap-left">\n                                            <div class="time-min">00</div>\n                                            <div class="time-max">24</div>\n                                        </li>\n                                        <li class="scale-item">\n                                            <div class="day">Mon</div>\n                                            <div class="add-times-left">\n                                                <div class="default-wrap">\n                                                    <div class="default-slider monday"></div>\n                                                </div>\n                                            </div>\n                                        </li>\n                                        <li class="scale-item">\n                                            <div class="day">Tue</div>\n                                            <div class="default-wrap">\n                                                <div class="default-slider  tuesday"></div>\n                                            </div>\n                                        </li>\n                                        <li class="scale-item">\n                                            <div class="day">Wed</div>\n                                            <div class="default-wrap">\n                                                <div class="default-slider wednesday"></div>\n                                            </div>\n                                        </li>\n                                        <li class="scale-item">\n                                            <div class="day">Th</div>\n                                            <div></div>\n                                            <div class="default-wrap">\n                                                <div class="default-slider thursday"></div>\n                                            </div>\n                                        </li>\n                                        <li class="scale-item">\n                                            <div class="day">Fr</div>\n                                            <div class="default-wrap">\n                                                <div class="default-slider  friday"></div>\n                                            </div>\n                                        </li>\n                                        <li class="scale-item">\n                                            <div class="day">Sat</div>\n                                            <div class="default-wrap">\n                                                <div class="default-slider  saturday"></div>\n                                            </div>\n                                        </li>\n                                        <li class="scale-item">\n                                            <div class="day">Sun</div>\n                                            <div class="add-times-right">\n                                                <div class="default-wrap">\n                                                    <div class="default-slider  sunday"></div>\n                                                </div>\n                                            </div>\n                                        </li>\n                                        <li class="times-wrap-right">\n                                            <div class="time-min">00</div>\n                                            <div class="time-max">24</div>\n                                        </li>\n                                    </ul>\n                                </div>\n                            </li>');i.addSlide(a)}function w(){H?($(".switch-on").removeClass("active"),$(".switch-off").addClass("active"),$(".default-wrap").addClass("slide-wrap"),$(".default-slider").addClass("slider"),$(".slider").removeClass("default-slider"),$(".slider").slider({min:0,max:23}),H=!1):0==H&&($(".switch-off").removeClass("active"),$(".switch-on").addClass("active"),$(".slide-wrap").addClass("default-wrap"),$(".default-wrap").removeClass("slide-wrap"),$(".slider").addClass("default-slider"),$(".default-slider").removeClass("slider"),H=!0,$(".default-slider.active-slider").each(function(e,i){var a=$(i).slider("values");$(i).slider("destroy"),o($(i),a)}))}function x(e,i){var a=$(e),s=[];if(s=H?[4,5,6,7,8,9,10,11,12,13,14]:[].concat(l(new Array(24).keys())),!a.hasClass("active-slider")){var n=r(H);if(a.hasClass("current-day")&&n>=23-S){var t=u(e,!1);if($(".flex-active-slide .default-wrap > div").index(t)==-1)return;x(t),$(t).addClass("active-slider")}else o(a),a.addClass("active-slider");return!0}var d=a.slider("values");a.hasClass("current-day")&&(s=s.filter(function(e){return!(e>=23-S)})),s=s.filter(function(e){return d.indexOf(e)==-1});var c=s[s.length-1];if(void 0!=c)return d.push(c),a.slider("destroy"),o(a,d),a.find(".ui-slider-handle:last").focus(),!0;if(i)return!1;var f=u(e,!1);if($(".flex-active-slide .default-wrap > div").index(f)==-1)return!1;x(f)}function g(e){var i=e.parent(),a=i.find(".ui-slider-handle").index(e),l=i.slider("values");l.splice(a,1),i.slider("destroy"),o(i,l)}function k(e){var i=E.clone(),a=e?i.add(e,"w"):i,l=a.isoWeekday(1).format("DD"),s=a.isoWeekday(7).format("DD"),n=a.format("MM");$(".item-week").html("Week "+l+"-"+s+"."+n)}function b(){var e=[];console.log("calculating moments..."),$(".flexslider .slides .item:not(.clone)").each(function(i,a){var l=E.week()+i;$(a).find(".default-wrap > div").each(function(i,a){var s=1+i;$(a).hasClass("active-slider")&&$(a).slider("values").map(function(e){return 23-e}).forEach(function(i){e.push(moment().year(E.year()).month(E.month()).week(l).day(s).hour(i).minute(0).second(0))})})}),e=e.filter(function(e){var i=E.clone().hour(S+1).minute(0).second(0);return e.unix()>=i.unix()});var i=e.map(function(e){return e.format("LLL")});console.log(i),console.log("object returned -> ",e)}Object.defineProperty(a,"__esModule",{value:!0}),a.setHandleSize=n,a.updateAllHandles=t,a.initSlider=o,a.initFirstSlider=c,a.getItems=h,a.addLastWeekSlide=y,a.daytimeSliderChanges=w,a.addHandle=x,a.deleteHandle=g,a.setWeekText=k,a.calculateAllHandles=b;var C,S,E;$(window).ready(function(){$("body").append('<div id="slider-popup"></div>'),C=$("#slider-popup"),S=moment().hour(),E=moment(),k()});var H=!0,A=100},{}]},{},[1]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZSIsInQiLCJuIiwiciIsInMiLCJvIiwidSIsImEiLCJyZXF1aXJlIiwiaSIsImYiLCJFcnJvciIsImNvZGUiLCJsIiwiZXhwb3J0cyIsImNhbGwiLCJsZW5ndGgiLCIxIiwibW9kdWxlIiwiX3dlZWtzIiwiJCIsIndpbmRvdyIsInJlYWR5Iiwib24iLCJzZXRIYW5kbGVTaXplIiwidGhpcyIsInZhbHVlIiwiY2FsY3VsYXRlQWxsSGFuZGxlcyIsImlzSW5pdGlhdGVkIiwiZGlzcGxheSIsImNsaWNrIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiZmxleHNsaWRlciIsImFuaW1hdGlvbiIsInNsaWRlc2hvdyIsImNvbnRyb2xOYXYiLCJjb250cm9sc0NvbnRhaW5lciIsImN1c3RvbURpcmVjdGlvbk5hdiIsImtleWJvYXJkIiwiYW5pbWF0aW9uTG9vcCIsImFmdGVyIiwiY3R4IiwiY3VycmVudFNsaWRlIiwibGFzdCIsImFkZExhc3RXZWVrU2xpZGUiLCJzZXRXZWVrVGV4dCIsImhpZGUiLCJzaG93IiwiZGF5IiwibW9tZW50IiwiaXNvV2Vla2RheSIsImFjdGl2ZUVsZW0iLCJmaXJzdFNsaWRlciIsImZpbmQiLCJhbGxGaXJzdFdlZWtTbGlkZXJzIiwicGFzdERheVNsaWRlcnMiLCJzcGxpY2UiLCJpbmRleCIsImZvckVhY2giLCJlbCIsImFkZENsYXNzIiwiaW5pdEZpcnN0U2xpZGVyIiwiZGF5dGltZVNsaWRlckNoYW5nZXMiLCJhbGxTbGlkZXJzIiwiZmlyc3RBY3RpdmVTbGlkZXIiLCJhZGRIYW5kbGUiLCJmb2N1c0VsZW0iLCJtb3VzZWRvd24iLCJoYXNDbGFzcyIsImRlbGV0ZUhhbmRsZSIsIi4vd2Vla3MiLCIyIiwiX3RvQ29uc3VtYWJsZUFycmF5IiwiYXJyIiwiQXJyYXkiLCJpc0FycmF5IiwiYXJyMiIsImZyb20iLCJnZXRBYnNvbHV0ZVJlY3QiLCJlbGVtIiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsInNjcm9sbFkiLCJib3R0b20iLCJsZWZ0Iiwic2Nyb2xsWCIsInJpZ2h0Iiwic2l6ZSIsImNvbnNvbGUiLCJsb2ciLCJIQU5ETEVfU0laRSIsInVwZGF0ZUFsbEhhbmRsZXMiLCJoZWlnaHRUb1NldCIsImNzcyIsImZpbHRlclZhbHVlcyIsInZhbHVlcyIsImRheXRpbWVfb24iLCJmaWx0ZXIiLCJ2IiwiZ2V0RGVmYXVsdFZhbHVlIiwiaG91ciIsImluaXRTbGlkZXIiLCJzZWxlY3RvciIsImRlZmF1bHRWYWx1ZSIsInNsaWRlciIsIm9yaWVudGF0aW9uIiwibWluIiwibWF4Iiwic3RlcCIsImFuaW1hdGUiLCJzdGFydCIsInVpIiwic2xpZGVyUG9wdXAiLCJ0ZXh0IiwiaGFuZGxlIiwic2xpZGUiLCJoYW5kbGVDdXJyZW50RGF5IiwidGhpc0Nvb3JkcyIsInBhZ2VYIiwicGFnZVkiLCJkaWZmVmFsdWVzIiwiaW5kZXhPZiIsInB1c2giLCJzdG9wIiwicmVtb3ZlQ2xhc3MiLCJzZXREcmFnZ2FibGVzIiwic3RhcnRIb3VyIiwibmV4dFNsaWRlciIsImZpbmROZXh0U2xpZGVyIiwiZ290b25leHQiLCJ0aGlzV2Vla1NsaWRlcnMiLCJzbGlkZXJJbmRleCIsImFjdGl2ZVNsaWRlIiwibmV4dFNsaWRlIiwibmV4dEVsZW1lbnRTaWJsaW5nIiwiZ29Ub05leHRTbGlkZSIsInRyaWdnZXIiLCJvZmYiLCJjbGVhcldyYXBFdmVudHMiLCJtb3ZlQXQiLCJ0YXJnZXRIYW5kbGUiLCJmb2N1cyIsInRhcmdldFNsaWRlciIsImNsb25lIiwid2lkdGgiLCJoZWlnaHQiLCJwYXJlbnQiLCJoYW5kbGVJbmRleCIsImFwcGVuZCIsImVhY2giLCJtb3VzZXVwIiwibmV3U2xpZGVyIiwiY3VycmVudFRhcmdldCIsImFwcGx5RHJhZ0FuZERyb3AiLCJtb3VzZW1vdmUiLCJyZW1vdmUiLCJvbGRTbGlkZXJWYWx1ZXMiLCJnZXRJdGVtcyIsImRhdGEiLCJ0ZW1wbGF0ZSIsImFkZFNsaWRlIiwiaXNGcm9tRHJhZyIsIiRzbGlkZXIiLCJwb3NzaWJsZUFyciIsImNvbmNhdCIsImtleXMiLCJudW0iLCJuZXdWYWx1ZSIsInVuZGVmaW5lZCIsIl9uZXh0U2xpZGVyIiwic2xpZGVJbmRleCIsInN0YXJ0TSIsInN0YXJ0TW9tZW50IiwibSIsImFkZCIsIm1vbmRheSIsImZvcm1hdCIsInN1bmRheSIsInRoaXNNb250aCIsImh0bWwiLCJjYWxjdWxhdGVkTW9tZW50cyIsIndlZWsiLCJtYXAiLCJ5ZWFyIiwibW9udGgiLCJtaW51dGUiLCJzZWNvbmQiLCJtb20iLCJjYW50R29QYXN0IiwidW5peCIsImluQ29uc29sZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Il0sIm1hcHBpbmdzIjoiQ0FBQSxRQUFVQSxHQUFFQyxFQUFFQyxFQUFFQyxHQUFHLFFBQVNDLEdBQUVDLEVBQUVDLEdBQUcsSUFBSUosRUFBRUcsR0FBRyxDQUFDLElBQUlKLEVBQUVJLEdBQUcsQ0FBQyxHQUFJRSxHQUFrQixrQkFBVEMsVUFBcUJBLE9BQVEsS0FBSUYsR0FBR0MsRUFBRSxNQUFPQSxHQUFFRixHQUFFLEVBQUksSUFBR0ksRUFBRSxNQUFPQSxHQUFFSixHQUFFLEVBQUksSUFBSUssR0FBRSxHQUFJQyxPQUFNLHVCQUF1Qk4sRUFBRSxJQUFLLE1BQU1LLEdBQUVFLEtBQUssbUJBQW1CRixFQUFFLEdBQUlHLEdBQUVYLEVBQUVHLElBQUlTLFdBQVliLEdBQUVJLEdBQUcsR0FBR1UsS0FBS0YsRUFBRUMsUUFBUSxTQUFTZCxHQUFHLEdBQUlFLEdBQUVELEVBQUVJLEdBQUcsR0FBR0wsRUFBRyxPQUFPSSxHQUFFRixFQUFFQSxFQUFFRixJQUFJYSxFQUFFQSxFQUFFQyxRQUFRZCxFQUFFQyxFQUFFQyxFQUFFQyxHQUFHLE1BQU9ELEdBQUVHLEdBQUdTLFFBQWtELElBQUksR0FBMUNMLEdBQWtCLGtCQUFURCxVQUFxQkEsUUFBZ0JILEVBQUUsRUFBRUEsRUFBRUYsRUFBRWEsT0FBT1gsSUFBSUQsRUFBRUQsRUFBRUUs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QSxFQUNyQjFGLEVBQVFpRCxnQkFBa0JBLEVBQzFCakQsRUFBUWtKLFNBQVdBLEVBQ25CbEosRUFBUWdDLGlCQUFtQkEsRUFDM0JoQyxFQUFRa0QscUJBQXVCQSxFQUMvQmxELEVBQVFxRCxVQUFZQSxFQUNwQnJELEVBQVF5RCxhQUFlQSxFQUN2QnpELEVBQVFpQyxZQUFjQSxFQUN0QmpDLEVBQVFhLG9CQUFzQkEsQ0FjOUIsSUFBSXdGLEdBQ0FjLEVBQ0E4QyxDQUNKM0osR0FBRUMsUUFBUUMsTUFBTSxXQUNaRixFQUFFLFFBQVFtSSxPQUFPLGlDQUNqQnBDLEVBQWMvRixFQUFFLGlCQUNoQjZHLEVBQVk5RSxTQUFTb0QsT0FDckJ3RSxFQUFjNUgsU0FDZEosS0FFSixJQUFJb0QsSUFBYSxFQUNiTixFQUFjLGNBMlhQIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSh7MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBfd2Vla3MgPSByZXF1aXJlKCcuL3dlZWtzJyk7XG5cbiQod2luZG93KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgJCgnI2hhbmRsZS1zaXplLXNlbGVjdCcpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICgwLCBfd2Vla3Muc2V0SGFuZGxlU2l6ZSkodGhpcy52YWx1ZSk7XG4gICAgfSk7XG4gICAgJCgnI2NhbGN1bGF0ZS1hbGwnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICgwLCBfd2Vla3MuY2FsY3VsYXRlQWxsSGFuZGxlcykoKTtcbiAgICB9KTtcblxuICAgIHZhciBpc0luaXRpYXRlZCA9IGZhbHNlO1xuXG4gICAgLy8gIE9QRU4gV0lER0VUXG4gICAge1xuICAgICAgICB2YXIgZGlzcGxheSA9IHZvaWQgMDtcbiAgICAgICAgJCgnLm9uLWJ0bicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm94Jykuc3R5bGUuZGlzcGxheTtcbiAgICAgICAgICAgIGlmIChkaXNwbGF5ID09ICdub25lJykge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcblxuICAgICAgICAgICAgICAgIGlmICghaXNJbml0aWF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNJbml0aWF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAkKCcuZmxleHNsaWRlcicpLmZsZXhzbGlkZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiAnc2xpZGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzaG93OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xOYXY6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbHNDb250YWluZXI6ICQoJy5jdXN0b20tY29udHJvbHMtY29udGFpbmVyJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21EaXJlY3Rpb25OYXY6ICQoJy5jdXN0b20tbmF2aWdhdGlvbiBhJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlib2FyZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25Mb29wOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXI6IGZ1bmN0aW9uIGFmdGVyKGN0eCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdHguY3VycmVudFNsaWRlID09IGN0eC5sYXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgwLCBfd2Vla3MuYWRkTGFzdFdlZWtTbGlkZSkoJCgnLmZsZXhzbGlkZXInKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICgwLCBfd2Vla3Muc2V0V2Vla1RleHQpKGN0eC5jdXJyZW50U2xpZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdHguY3VycmVudFNsaWRlID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmZsZXgtcHJldicpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmZsZXgtcHJldi1ibG9jaycpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuZmxleC1wcmV2Jykuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuZmxleC1wcmV2LWJsb2NrJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBDdXJyZW50IGRheSBzbGlkZXIgYWN0aXZlLCB3aXRoIG9uZSB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF5ID0gbW9tZW50KCkuaXNvV2Vla2RheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2ZUVsZW0gPSB2b2lkIDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGRheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRWxlbSA9ICcubW9uZGF5JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVFbGVtID0gJy50dWVzZGF5JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVFbGVtID0gJy53ZWRuZXNkYXknO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZUVsZW0gPSAnLnRodXJzZGF5JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVFbGVtID0gJy5mcmlkYXknO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZUVsZW0gPSAnLnNhdHVyZGF5JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVFbGVtID0gJy5zdW5kYXknO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaXJzdFNsaWRlciA9ICQoJy5mbGV4LWFjdGl2ZS1zbGlkZScpLmZpbmQoYWN0aXZlRWxlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxsRmlyc3RXZWVrU2xpZGVycyA9ICQoJy5mbGV4LWFjdGl2ZS1zbGlkZSAuZGVmYXVsdC13cmFwID4gZGl2Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFzdERheVNsaWRlcnMgPSBhbGxGaXJzdFdlZWtTbGlkZXJzLnNwbGljZSgwLCBhbGxGaXJzdFdlZWtTbGlkZXJzLmluZGV4KGZpcnN0U2xpZGVyKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXN0RGF5U2xpZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1hcmsgcGFzdCBkYXlzIChjYW50IG1vdmUvY3JlYXRlIGhhbmRsZXMgdGhlcmUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbCkuYWRkQ2xhc3MoJ3Bhc3QtZGF5Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICgwLCBfd2Vla3MuaW5pdEZpcnN0U2xpZGVyKShmaXJzdFNsaWRlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRpc3BsYXkgPT0gJ2Jsb2NrJykge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLy8gQ0xPU0VTIFdJREdFVFxuICAgICQoJy5jbG9zZS1idXR0b24nKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH0pO1xuXG4gICAgLy8gREFZVElNRSBPTkxZIE9GRiBPUiBPTlxuXG5cbiAgICAkKCcuc3dpdGNoLW9uJykuY2xpY2soX3dlZWtzLmRheXRpbWVTbGlkZXJDaGFuZ2VzKTtcbiAgICAkKCcuc3dpdGNoLW9mZicpLmNsaWNrKF93ZWVrcy5kYXl0aW1lU2xpZGVyQ2hhbmdlcyk7XG5cbiAgICAkKCcuZmxleC1wcmV2JykuaGlkZSgpO1xuICAgICQoJy5mbGV4LXByZXYtYmxvY2snKS5zaG93KCk7XG5cbiAgICAvLyBBREQgQU5EIERFTCBCVVRUT05cblxuICAgICQoJy5hZGQtYnV0dG9uJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYWxsU2xpZGVycyA9ICQoJy5mbGV4LWFjdGl2ZS1zbGlkZSAuZGVmYXVsdC13cmFwID4gZGl2Om5vdCgucGFzdC1kYXkpJyk7XG4gICAgICAgIHZhciBmaXJzdEFjdGl2ZVNsaWRlciA9IGFsbFNsaWRlcnNbMF07XG4gICAgICAgICgwLCBfd2Vla3MuYWRkSGFuZGxlKShmaXJzdEFjdGl2ZVNsaWRlcik7XG4gICAgfSk7XG4gICAge1xuICAgICAgICB2YXIgZm9jdXNFbGVtID0gbnVsbDtcbiAgICAgICAgJCgnLmRlbC1idXR0b24nKS5tb3VzZWRvd24oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCgnOmZvY3VzJykuaGFzQ2xhc3MoJ3VpLXNsaWRlci1oYW5kbGUnKSA/IGZvY3VzRWxlbSA9ICQoJzpmb2N1cycpIDogZm9jdXNFbGVtID0gbnVsbDtcbiAgICAgICAgfSk7XG4gICAgICAgICQoJy5kZWwtYnV0dG9uJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKGZvY3VzRWxlbSkge1xuICAgICAgICAgICAgICAgICgwLCBfd2Vla3MuZGVsZXRlSGFuZGxlKShmb2N1c0VsZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KTtcbi8vVE9ETyBmaXggd2hpdGUgc2xpZGVyIHNpemUgRE9ORVxuLy9UT0RPIG1ha2UgaGFuZGxlcyBhcHBlYXIgaW4gb3JkZXIsIG9yIG9uIG5leHQgc2xpZGVyIGlmIG5vd2hlcmUgdG8gYWRkIERPTkVcbi8vVE9ETyAzMDAgYW5kIDQwMCBzaXplcyBnbyBvdXRzaWRlIG9mIGJvcmRlclxuLy9UT0RPID8/P1xuLy9UT0RPIHBsdXMgb24gYWRkIGJ1dHRvbiBjZW50ZXJlZFxuXG59LHtcIi4vd2Vla3NcIjoyfV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICAgIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuc2V0SGFuZGxlU2l6ZSA9IHNldEhhbmRsZVNpemU7XG5leHBvcnRzLnVwZGF0ZUFsbEhhbmRsZXMgPSB1cGRhdGVBbGxIYW5kbGVzO1xuZXhwb3J0cy5pbml0U2xpZGVyID0gaW5pdFNsaWRlcjtcbmV4cG9ydHMuaW5pdEZpcnN0U2xpZGVyID0gaW5pdEZpcnN0U2xpZGVyO1xuZXhwb3J0cy5nZXRJdGVtcyA9IGdldEl0ZW1zO1xuZXhwb3J0cy5hZGRMYXN0V2Vla1NsaWRlID0gYWRkTGFzdFdlZWtTbGlkZTtcbmV4cG9ydHMuZGF5dGltZVNsaWRlckNoYW5nZXMgPSBkYXl0aW1lU2xpZGVyQ2hhbmdlcztcbmV4cG9ydHMuYWRkSGFuZGxlID0gYWRkSGFuZGxlO1xuZXhwb3J0cy5kZWxldGVIYW5kbGUgPSBkZWxldGVIYW5kbGU7XG5leHBvcnRzLnNldFdlZWtUZXh0ID0gc2V0V2Vla1RleHQ7XG5leHBvcnRzLmNhbGN1bGF0ZUFsbEhhbmRsZXMgPSBjYWxjdWxhdGVBbGxIYW5kbGVzO1xuXG5mdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IGVsc2UgeyByZXR1cm4gQXJyYXkuZnJvbShhcnIpOyB9IH1cblxuZnVuY3Rpb24gZ2V0QWJzb2x1dGVSZWN0KGVsZW0pIHtcbiAgICB2YXIgcmVjdCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdG9wOiByZWN0LnRvcCArIHdpbmRvdy5zY3JvbGxZLFxuICAgICAgICBib3R0b206IHJlY3QuYm90dG9tICsgd2luZG93LnNjcm9sbFksXG4gICAgICAgIGxlZnQ6IHJlY3QubGVmdCArIHdpbmRvdy5zY3JvbGxYLFxuICAgICAgICByaWdodDogcmVjdC5yaWdodCArIHdpbmRvdy5zY3JvbGxYXG4gICAgfTtcbn1cblxudmFyIHNsaWRlclBvcHVwO1xudmFyIHN0YXJ0SG91cjsgLy8gaG91ciBvbiB3aGljaCB3aWRnZXQgc3RhcnRlZCwgaGFuZGxlcyBjYW50IHN0ZXAgb24gaXQgYW5kIHBhc3QgaXRcbnZhciBzdGFydE1vbWVudDtcbiQod2luZG93KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgJCgnYm9keScpLmFwcGVuZCgnPGRpdiBpZD1cInNsaWRlci1wb3B1cFwiPjwvZGl2PicpO1xuICAgIHNsaWRlclBvcHVwID0gJCgnI3NsaWRlci1wb3B1cCcpO1xuICAgIHN0YXJ0SG91ciA9IG1vbWVudCgpLmhvdXIoKTtcbiAgICBzdGFydE1vbWVudCA9IG1vbWVudCgpO1xuICAgIHNldFdlZWtUZXh0KCk7XG59KTtcbnZhciBkYXl0aW1lX29uID0gdHJ1ZTtcbnZhciBIQU5ETEVfU0laRSA9IDEwMDtcbmZ1bmN0aW9uIHNldEhhbmRsZVNpemUoc2l6ZSkge1xuICAgIGNvbnNvbGUubG9nKHNpemUpO1xuICAgIEhBTkRMRV9TSVpFID0gc2l6ZTtcbiAgICB1cGRhdGVBbGxIYW5kbGVzKCk7XG59XG5mdW5jdGlvbiB1cGRhdGVBbGxIYW5kbGVzKCkge1xuICAgIHZhciBoZWlnaHRUb1NldDtcbiAgICBpZiAoSEFORExFX1NJWkUgPT0gMTAwKSB7XG4gICAgICAgIGhlaWdodFRvU2V0ID0gJzhweCc7XG4gICAgfSBlbHNlIGlmIChIQU5ETEVfU0laRSA9PSAyMDApIHtcbiAgICAgICAgaGVpZ2h0VG9TZXQgPSAnMTZweCc7XG4gICAgfSBlbHNlIGlmIChIQU5ETEVfU0laRSA9PSAzMDApIHtcbiAgICAgICAgaGVpZ2h0VG9TZXQgPSAnMjRweCc7XG4gICAgfSBlbHNlIGlmIChIQU5ETEVfU0laRSA9PSA0MDApIHtcbiAgICAgICAgaGVpZ2h0VG9TZXQgPSAnMzJweCc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2luY29ycmVjdCBIQU5ETEVfU0laRSB2YWx1ZSEnKTtcbiAgICAgICAgaGVpZ2h0VG9TZXQgPSAnOHB4JztcbiAgICB9XG4gICAgJCgnLnVpLXNsaWRlci1oYW5kbGUnKS5jc3MoJ2hlaWdodCcsIGhlaWdodFRvU2V0KTtcbn1cblxuZnVuY3Rpb24gZmlsdGVyVmFsdWVzKHZhbHVlcywgZGF5dGltZV9vbikge1xuICAgIGlmIChkYXl0aW1lX29uKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdmaWx0ZXJpbmcuLi4nLCB2YWx1ZXMpO1xuICAgICAgICB2YWx1ZXMgPSB2YWx1ZXMuZmlsdGVyKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICBpZiAodiA8PSAxNCAmJiB2ID49IDQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2codmFsdWVzKTtcbiAgICByZXR1cm4gdmFsdWVzO1xufVxuZnVuY3Rpb24gZ2V0RGVmYXVsdFZhbHVlKGRheXRpbWVfb24pIHtcbiAgICB2YXIgdmFsdWUgPSAyMyAtIChtb21lbnQoKS5ob3VyKCkgKyAxKTtcbiAgICBpZiAodmFsdWUgPCAwKSB2YWx1ZSA9IDA7XG4gICAgaWYgKGRheXRpbWVfb24pIHtcbiAgICAgICAgaWYgKHZhbHVlIDwgNCkgdmFsdWUgPSA0O2Vsc2UgaWYgKHZhbHVlID4gMTQpIHZhbHVlID0gMTQ7XG4gICAgfVxuICAgIC8vIGNvbnNvbGUubG9nKCdkZWZhdWx0JywgdmFsdWUpO1xuICAgIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIGluaXRTbGlkZXIoc2VsZWN0b3IsIHZhbHVlcykge1xuICAgIHZhciBkZWZhdWx0VmFsdWU7XG4gICAgaWYgKHNlbGVjdG9yLmhhc0NsYXNzKCdjdXJyZW50LWRheScpKSB7XG4gICAgICAgIGRlZmF1bHRWYWx1ZSA9IGdldERlZmF1bHRWYWx1ZShkYXl0aW1lX29uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBkZWZhdWx0VmFsdWUgPSBkYXl0aW1lX29uID8gMTQgOiAyMztcbiAgICB9XG4gICAgdmFsdWVzID0gdmFsdWVzID8gZmlsdGVyVmFsdWVzKHZhbHVlcywgZGF5dGltZV9vbikgOiBbZGVmYXVsdFZhbHVlXTtcbiAgICBzZWxlY3Rvci5zbGlkZXIoe1xuICAgICAgICBvcmllbnRhdGlvbjogJ3ZlcnRpY2FsJyxcbiAgICAgICAgbWluOiBkYXl0aW1lX29uID8gNCA6IDAsXG4gICAgICAgIG1heDogZGF5dGltZV9vbiA/IDE0IDogMjMsXG4gICAgICAgIHZhbHVlczogdmFsdWVzLFxuICAgICAgICBzdGVwOiAxLFxuICAgICAgICBhbmltYXRlOiB0cnVlLFxuICAgICAgICBzdGFydDogZnVuY3Rpb24gc3RhcnQoZSwgdWkpIHtcbiAgICAgICAgICAgIHZhciB2ID0gMjMgLSB1aS52YWx1ZTtcbiAgICAgICAgICAgIHNsaWRlclBvcHVwLnRleHQodik7XG4gICAgICAgICAgICBzbGlkZXJQb3B1cC5zaG93KCk7XG4gICAgICAgICAgICBzbGlkZXJQb3B1cC5jc3MoJ3RvcCcsIGdldEFic29sdXRlUmVjdCh1aS5oYW5kbGUpLnRvcCAtIDEwKTtcbiAgICAgICAgICAgIHNsaWRlclBvcHVwLmNzcygnbGVmdCcsIGdldEFic29sdXRlUmVjdCh1aS5oYW5kbGUpLmxlZnQgKyAzMCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNsaWRlOiBmdW5jdGlvbiBzbGlkZShlLCB1aSkge1xuICAgICAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2N1cnJlbnQtZGF5JykpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWhhbmRsZUN1cnJlbnREYXkodWkpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdGhpc0Nvb3JkcyA9IGdldEFic29sdXRlUmVjdCh0aGlzKTtcbiAgICAgICAgICAgIC8vIG9ubHkgdHJpZ2dlcmluZyB0aGUgZXZlbnQgaWYgbW91c2UgaXMgaW4gYSByYW5nZSBvZiB0aGUgc2xpZGVyXG4gICAgICAgICAgICBpZiAoIShlLnBhZ2VYIDwgdGhpc0Nvb3Jkcy5yaWdodCArIDEwICYmIGUucGFnZVggPiB0aGlzQ29vcmRzLmxlZnQgLSAxMCAmJiBlLnBhZ2VZIDwgdGhpc0Nvb3Jkcy5ib3R0b20gKyAxMCAmJiBlLnBhZ2VZID4gdGhpc0Nvb3Jkcy50b3AgLSAxMCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZGlmZlZhbHVlcyA9IFtdO1xuICAgICAgICAgICAgLy8gcHJldmVudCBoYW5kbGUgb3ZlcmxhcHBpbmdcbiAgICAgICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgdWkudmFsdWVzLmxlbmd0aDsgYSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpZmZWYWx1ZXMuaW5kZXhPZih1aS52YWx1ZXNbYV0pID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRpZmZWYWx1ZXMucHVzaCh1aS52YWx1ZXNbYV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHYgPSAyMyAtIHVpLnZhbHVlO1xuICAgICAgICAgICAgc2xpZGVyUG9wdXAudGV4dCh2KTtcbiAgICAgICAgICAgIHNsaWRlclBvcHVwLmNzcygndG9wJywgZ2V0QWJzb2x1dGVSZWN0KHVpLmhhbmRsZSkudG9wIC0gMTApO1xuICAgICAgICAgICAgc2xpZGVyUG9wdXAuY3NzKCdsZWZ0JywgZ2V0QWJzb2x1dGVSZWN0KHVpLmhhbmRsZSkubGVmdCArIDMwKTtcbiAgICAgICAgfSxcbiAgICAgICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHtcbiAgICAgICAgICAgIHNsaWRlclBvcHVwLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGNvbnNvbGUoJ1ZBTFVFUycsIHZhbHVlcyk7XG4gICAgaWYgKHZhbHVlcy5sZW5ndGggPT0gMCkge1xuICAgICAgICBzZWxlY3Rvci5yZW1vdmVDbGFzcygnYWN0aXZlLXNsaWRlcicpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGVjdG9yLmFkZENsYXNzKCdhY3RpdmUtc2xpZGVyJyk7XG4gICAgfVxuICAgIHNldERyYWdnYWJsZXMoKTtcbiAgICB1cGRhdGVBbGxIYW5kbGVzKCk7XG59XG5cbmZ1bmN0aW9uIGluaXRGaXJzdFNsaWRlcihzZWxlY3Rvcikge1xuICAgIHNlbGVjdG9yLmFkZENsYXNzKCdjdXJyZW50LWRheScpO1xuICAgIHZhciBkZWZhdWx0VmFsdWUgPSBnZXREZWZhdWx0VmFsdWUoZGF5dGltZV9vbik7XG4gICAgaWYgKGRlZmF1bHRWYWx1ZSA+PSAyMyAtIHN0YXJ0SG91cikge1xuICAgICAgICAvLyBjb25zb2xlKCdjdXJyZW50IGRheSB3aXRoIGFuIGV4Y2VwdGlvbicpO1xuICAgICAgICB2YXIgbmV4dFNsaWRlciA9IGZpbmROZXh0U2xpZGVyKHNlbGVjdG9yLCB0cnVlKTtcbiAgICAgICAgaW5pdFNsaWRlcigkKG5leHRTbGlkZXIpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpbml0U2xpZGVyKHNlbGVjdG9yKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGZpbmROZXh0U2xpZGVyKHNlbGVjdG9yLCBnb3RvbmV4dCkge1xuICAgIHZhciB0aGlzV2Vla1NsaWRlcnMgPSAkKCcuZmxleC1hY3RpdmUtc2xpZGUgLmRlZmF1bHQtd3JhcCA+IGRpdicpO1xuICAgIHZhciBzbGlkZXJJbmRleCA9IHRoaXNXZWVrU2xpZGVycy5pbmRleChzZWxlY3Rvcik7XG4gICAgLy8gaWYgbm90IHN1bmRheVxuICAgIHZhciBuZXh0U2xpZGVyO1xuICAgIGlmIChzbGlkZXJJbmRleCAhPSA2KSB7XG4gICAgICAgIG5leHRTbGlkZXIgPSB0aGlzV2Vla1NsaWRlcnNbc2xpZGVySW5kZXggKyAxXTtcbiAgICB9XG4gICAgLy8gaWYgc3VuZGF5XG4gICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgYWN0aXZlU2xpZGUgPSAkKCcuZmxleC1hY3RpdmUtc2xpZGUnKVswXTtcbiAgICAgICAgICAgIHZhciBuZXh0U2xpZGUgPSBhY3RpdmVTbGlkZS5uZXh0RWxlbWVudFNpYmxpbmc7XG4gICAgICAgICAgICBuZXh0U2xpZGVyID0gJChuZXh0U2xpZGUpLmZpbmQoJy5tb25kYXknKTtcbiAgICAgICAgICAgIGlmIChnb3RvbmV4dCkgZ29Ub05leHRTbGlkZSgpO1xuICAgICAgICB9XG4gICAgcmV0dXJuIG5leHRTbGlkZXI7XG59XG5cbmZ1bmN0aW9uIGdvVG9OZXh0U2xpZGUoKSB7XG4gICAgJCgnLmZsZXgtbmV4dCcpLnRyaWdnZXIoJ2NsaWNrJyk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUN1cnJlbnREYXkodWkpIHtcbiAgICByZXR1cm4gdWkudmFsdWUgPCAyMyAtIHN0YXJ0SG91cjtcbn1cblxuZnVuY3Rpb24gc2V0RHJhZ2dhYmxlcygpIHtcbiAgICAkKCcudWktc2xpZGVyLWhhbmRsZScpLm9mZignbW91c2Vkb3duJyk7XG4gICAgJCgnLnVpLXNsaWRlci1oYW5kbGUnKS5vbignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ21vdXNlZG93bicsIHRoaXMpO1xuICAgICAgICB2YXIgdGFyZ2V0SGFuZGxlID0gdGhpcztcbiAgICAgICAgJCh0YXJnZXRIYW5kbGUpLmZvY3VzKCk7IC8vIGZpeCBpbmNvcnJlY3QgZm9jdXMgYnVnXG4gICAgICAgIC8vIGNvbnNvbGUodGFyZ2V0SGFuZGxlKTtcbiAgICAgICAgdmFyIHRhcmdldFNsaWRlciA9ICQodGhpcykucGFyZW50KClbMF07XG4gICAgICAgIHZhciBoYW5kbGVJbmRleCA9ICQodGFyZ2V0U2xpZGVyKS5maW5kKCcudWktc2xpZGVyLWhhbmRsZScpLmluZGV4KHRhcmdldEhhbmRsZSk7XG4gICAgICAgIHZhciBzbGlkZXJJbmRleCA9ICQoJy5mbGV4LWFjdGl2ZS1zbGlkZSAuc2NhbGUtaXRlbSAuZGVmYXVsdC13cmFwID4gZGl2JykuaW5kZXgoJCh0YXJnZXRTbGlkZXIpKTtcbiAgICAgICAgdmFyIGNsb25lID0gJCh0aGlzKS5jbG9uZSgpLmFkZENsYXNzKCdoYW5kbGUtY2xvbmUnKTtcbiAgICAgICAgY2xvbmUuY3NzKCd3aWR0aCcsICQodGFyZ2V0SGFuZGxlKS53aWR0aCgpKS5jc3MoJ2hlaWdodCcsICQodGFyZ2V0SGFuZGxlKS5oZWlnaHQoKSk7XG4gICAgICAgIG1vdmVBdChlKTtcbiAgICAgICAgJCgnYm9keScpLmFwcGVuZChjbG9uZSk7XG4gICAgICAgIC8vIGNvbnNvbGUoJ3NsaWRlckluZGV4Jywgc2xpZGVySW5kZXgpO1xuICAgICAgICBmdW5jdGlvbiBpbml0V3JhcEV2ZW50cygpIHtcbiAgICAgICAgICAgICQoJy5mbGV4LWFjdGl2ZS1zbGlkZSAuc2NhbGUtaXRlbSAuZGVmYXVsdC13cmFwJykuZWFjaChmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgICAgICAgICBpZiAoaSAhPT0gc2xpZGVySW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2F0dGFjaGluZyBldmVudCcsIGVsKTtcbiAgICAgICAgICAgICAgICAgICAgJChlbCkubW91c2V1cChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1NsaWRlciA9ICQoZS5jdXJyZW50VGFyZ2V0KS5maW5kKCdkaXYnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlEcmFnQW5kRHJvcChlLCB0YXJnZXRTbGlkZXIsIG5ld1NsaWRlciwgaGFuZGxlSW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBjbGVhcldyYXBFdmVudHMoKSB7XG4gICAgICAgICAgICAkKCcuZmxleC1hY3RpdmUtc2xpZGUgLnNjYWxlLWl0ZW0gLmRlZmF1bHQtd3JhcCcpLm9mZignbW91c2V1cCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaW5pdFdyYXBFdmVudHMoKTtcblxuICAgICAgICBmdW5jdGlvbiBtb3ZlQXQoZSkge1xuICAgICAgICAgICAgJCh0YXJnZXRIYW5kbGUpLmZvY3VzKCk7IC8vIGZpeCBpbmNvcnJlY3QgZm9jdXMgYnVnXG4gICAgICAgICAgICB2YXIgdGhpc0Nvb3JkcyA9IGdldEFic29sdXRlUmVjdCh0YXJnZXRTbGlkZXIpO1xuICAgICAgICAgICAgaWYgKGUucGFnZVggPCB0aGlzQ29vcmRzLnJpZ2h0ICsgMTAgJiYgZS5wYWdlWCA+IHRoaXNDb29yZHMubGVmdCAtIDEwICYmIGUucGFnZVkgPCB0aGlzQ29vcmRzLmJvdHRvbSArIDEwICYmIGUucGFnZVkgPiB0aGlzQ29vcmRzLnRvcCAtIDEwKSB7XG4gICAgICAgICAgICAgICAgY2xvbmUuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2xvbmUuY3NzKCdkaXNwbGF5JywgJ2luaXRpYWwnKTtcbiAgICAgICAgICAgICAgICBjbG9uZS5jc3MoJ2xlZnQnLCBlLnBhZ2VYIC0gY2xvbmUud2lkdGgoKSAvIDIpO1xuICAgICAgICAgICAgICAgIGNsb25lLmNzcygndG9wJywgZS5wYWdlWSAtIGNsb25lLmhlaWdodCgpIC8gMik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgJCgnYm9keScpLm1vdXNlbW92ZShmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ21vdXNlbW92ZScpO1xuICAgICAgICAgICAgbW92ZUF0KGUpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCdib2R5JykubW91c2V1cChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ21vdXNldXAnKTtcbiAgICAgICAgICAgICQoJ2JvZHknKS5vZmYoJ21vdXNlbW92ZScpO1xuICAgICAgICAgICAgJCgnYm9keScpLm9mZignbW91c2V1cCcpO1xuICAgICAgICAgICAgY2xvbmUucmVtb3ZlKCk7XG4gICAgICAgICAgICBjbGVhcldyYXBFdmVudHMoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGFwcGx5RHJhZ0FuZERyb3AoZSwgdGFyZ2V0U2xpZGVyLCBuZXdTbGlkZXIsIGhhbmRsZUluZGV4KSB7XG4gICAgaWYgKG5ld1NsaWRlci5oYXNDbGFzcygncGFzdC1kYXknKSkgcmV0dXJuO1xuICAgIGlmIChuZXdTbGlkZXIuaGFzQ2xhc3MoJ2N1cnJlbnQtZGF5JykpIHtcbiAgICAgICAgdmFyIGRlZmF1bHRWYWx1ZSA9IGdldERlZmF1bHRWYWx1ZShkYXl0aW1lX29uKTtcbiAgICAgICAgaWYgKGRlZmF1bHRWYWx1ZSA+PSAyMyAtIHN0YXJ0SG91cikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGNvbnNvbGUubG9nKGUpO1xuICAgIHZhciBvbGRTbGlkZXJWYWx1ZXMgPSAkKHRhcmdldFNsaWRlcikuc2xpZGVyKCd2YWx1ZXMnKTtcbiAgICBvbGRTbGlkZXJWYWx1ZXMuc3BsaWNlKGhhbmRsZUluZGV4LCAxKTtcbiAgICB2YXIgd2FzQWRkZWQgPSBhZGRIYW5kbGUobmV3U2xpZGVyLCB0cnVlKTtcbiAgICAvLyBpZiBzbGlkZXIgYWN0dWFsbHkgZGlkbnQgdXBkYXRlIChub3QgZW5vdWdoIHBsYWNlKSwgZG8gbm90aGluZ1xuICAgIGlmICh3YXNBZGRlZCkge1xuICAgICAgICAkKHRhcmdldFNsaWRlcikuc2xpZGVyKCdkZXN0cm95Jyk7XG4gICAgICAgIGluaXRTbGlkZXIoJCh0YXJnZXRTbGlkZXIpLCBvbGRTbGlkZXJWYWx1ZXMpO1xuICAgIH1cbiAgICBzbGlkZXJQb3B1cC5oaWRlKCk7XG59XG5cbmZ1bmN0aW9uIGdldEl0ZW1zKCkge1xuICAgIHJldHVybiAkKCcuZmxleHNsaWRlciAuc2xpZGVzIC5pdGVtOm5vdCguY2xvbmUpJyk7XG59XG5cbmZ1bmN0aW9uIGFkZExhc3RXZWVrU2xpZGUoc2VsZWN0b3IpIHtcbiAgICB2YXIgY3R4ID0gc2VsZWN0b3IuZGF0YSgnZmxleHNsaWRlcicpO1xuXG4gICAgdmFyIHRlbXBsYXRlID0gJCgnPGxpIGNsYXNzPVwiaXRlbVwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIml0ZW0td2Vla1wiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2NhbGUtd3JhcHBlclwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz1cImxpc3Qtc2NhbGUtd3JhcFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9XCJ0aW1lcy13cmFwLWxlZnRcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aW1lLW1pblwiPjAwPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGltZS1tYXhcIj4yNDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9XCJzY2FsZS1pdGVtXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGF5XCI+TW9uPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYWRkLXRpbWVzLWxlZnRcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGVmYXVsdC13cmFwXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkZWZhdWx0LXNsaWRlciBtb25kYXlcIj48L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9XCJzY2FsZS1pdGVtXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGF5XCI+VHVlPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGVmYXVsdC13cmFwXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRlZmF1bHQtc2xpZGVyICB0dWVzZGF5XCI+PC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9saT5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPVwic2NhbGUtaXRlbVwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRheVwiPldlZDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRlZmF1bHQtd3JhcFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkZWZhdWx0LXNsaWRlciB3ZWRuZXNkYXlcIj48L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9XCJzY2FsZS1pdGVtXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGF5XCI+VGg8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGVmYXVsdC13cmFwXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRlZmF1bHQtc2xpZGVyIHRodXJzZGF5XCI+PC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9saT5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPVwic2NhbGUtaXRlbVwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRheVwiPkZyPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGVmYXVsdC13cmFwXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRlZmF1bHQtc2xpZGVyICBmcmlkYXlcIj48L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9XCJzY2FsZS1pdGVtXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGF5XCI+U2F0PC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGVmYXVsdC13cmFwXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRlZmF1bHQtc2xpZGVyICBzYXR1cmRheVwiPjwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzcz1cInNjYWxlLWl0ZW1cIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkYXlcIj5TdW48L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJhZGQtdGltZXMtcmlnaHRcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGVmYXVsdC13cmFwXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkZWZhdWx0LXNsaWRlciAgc3VuZGF5XCI+PC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9saT5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPVwidGltZXMtd3JhcC1yaWdodFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRpbWUtbWluXCI+MDA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aW1lLW1heFwiPjI0PC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC91bD5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPicpO1xuICAgIGN0eC5hZGRTbGlkZSh0ZW1wbGF0ZSk7XG59XG5cbmZ1bmN0aW9uIGRheXRpbWVTbGlkZXJDaGFuZ2VzKCkge1xuICAgIGlmIChkYXl0aW1lX29uKSB7XG4gICAgICAgICQoJy5zd2l0Y2gtb24nKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICQoJy5zd2l0Y2gtb2ZmJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAkKCcuZGVmYXVsdC13cmFwJykuYWRkQ2xhc3MoJ3NsaWRlLXdyYXAnKTtcbiAgICAgICAgJCgnLmRlZmF1bHQtc2xpZGVyJykuYWRkQ2xhc3MoJ3NsaWRlcicpO1xuICAgICAgICAkKCcuc2xpZGVyJykucmVtb3ZlQ2xhc3MoJ2RlZmF1bHQtc2xpZGVyJyk7XG5cbiAgICAgICAgJCgnLnNsaWRlcicpLnNsaWRlcih7XG4gICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICBtYXg6IDIzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRheXRpbWVfb24gPSBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKGRheXRpbWVfb24gPT0gZmFsc2UpIHtcbiAgICAgICAgJCgnLnN3aXRjaC1vZmYnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICQoJy5zd2l0Y2gtb24nKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICQoJy5zbGlkZS13cmFwJykuYWRkQ2xhc3MoJ2RlZmF1bHQtd3JhcCcpO1xuICAgICAgICAkKCcuZGVmYXVsdC13cmFwJykucmVtb3ZlQ2xhc3MoJ3NsaWRlLXdyYXAnKTtcbiAgICAgICAgJCgnLnNsaWRlcicpLmFkZENsYXNzKCdkZWZhdWx0LXNsaWRlcicpO1xuICAgICAgICAkKCcuZGVmYXVsdC1zbGlkZXInKS5yZW1vdmVDbGFzcygnc2xpZGVyJyk7XG5cbiAgICAgICAgZGF5dGltZV9vbiA9IHRydWU7XG4gICAgICAgICQoJy5kZWZhdWx0LXNsaWRlci5hY3RpdmUtc2xpZGVyJykuZWFjaChmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSAkKGVsKS5zbGlkZXIoJ3ZhbHVlcycpO1xuICAgICAgICAgICAgJChlbCkuc2xpZGVyKCdkZXN0cm95Jyk7XG4gICAgICAgICAgICBpbml0U2xpZGVyKCQoZWwpLCB2YWx1ZXMpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGFkZEhhbmRsZShzZWxlY3RvciwgaXNGcm9tRHJhZykge1xuICAgIHZhciAkc2xpZGVyID0gJChzZWxlY3Rvcik7XG4gICAgLy8gY29uc29sZS5sb2coJHNsaWRlcik7XG4gICAgdmFyIHBvc3NpYmxlQXJyID0gW107XG4gICAgLy8gYSBsaXN0IG9mIHBvc3NpYmxlIGhhbmRsZSB2YWx1ZXMgd2hpY2ggY2FuIGJlIGFkZGVkXG4gICAgaWYgKGRheXRpbWVfb24pIHBvc3NpYmxlQXJyID0gWzQsIDUsIDYsIDcsIDgsIDksIDEwLCAxMSwgMTIsIDEzLCAxNF07ZWxzZSB7XG4gICAgICAgIHBvc3NpYmxlQXJyID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShuZXcgQXJyYXkoMjQpLmtleXMoKSkpO1xuICAgIH1cbiAgICBpZiAoISRzbGlkZXIuaGFzQ2xhc3MoJ2FjdGl2ZS1zbGlkZXInKSkge1xuICAgICAgICB2YXIgZGVmYXVsdFZhbHVlID0gZ2V0RGVmYXVsdFZhbHVlKGRheXRpbWVfb24pO1xuICAgICAgICBpZiAoJHNsaWRlci5oYXNDbGFzcygnY3VycmVudC1kYXknKSAmJiBkZWZhdWx0VmFsdWUgPj0gMjMgLSBzdGFydEhvdXIpIHtcbiAgICAgICAgICAgIHZhciBuZXh0U2xpZGVyID0gZmluZE5leHRTbGlkZXIoc2VsZWN0b3IsIGZhbHNlKTtcbiAgICAgICAgICAgIC8vIGlmIG5leHQgc2xpZGVyIGlzIG9uIGFub3RoZXIgZmxleFNsaWRlXG4gICAgICAgICAgICBpZiAoJCgnLmZsZXgtYWN0aXZlLXNsaWRlIC5kZWZhdWx0LXdyYXAgPiBkaXYnKS5pbmRleChuZXh0U2xpZGVyKSA9PSAtMSkge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdmaXghJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWRkSGFuZGxlKG5leHRTbGlkZXIpO1xuICAgICAgICAgICAgJChuZXh0U2xpZGVyKS5hZGRDbGFzcygnYWN0aXZlLXNsaWRlcicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW5pdFNsaWRlcigkc2xpZGVyKTtcbiAgICAgICAgICAgICRzbGlkZXIuYWRkQ2xhc3MoJ2FjdGl2ZS1zbGlkZXInKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdmFsdWVzID0gJHNsaWRlci5zbGlkZXIoJ3ZhbHVlcycpO1xuICAgICAgICBpZiAoJHNsaWRlci5oYXNDbGFzcygnY3VycmVudC1kYXknKSkge1xuICAgICAgICAgICAgcG9zc2libGVBcnIgPSBwb3NzaWJsZUFyci5maWx0ZXIoZnVuY3Rpb24gKG51bSkge1xuICAgICAgICAgICAgICAgIGlmIChudW0gPj0gMjMgLSBzdGFydEhvdXIpIHJldHVybiBmYWxzZTtlbHNlIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcG9zc2libGVBcnIgPSBwb3NzaWJsZUFyci5maWx0ZXIoZnVuY3Rpb24gKG51bSkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlcy5pbmRleE9mKG51bSkgPT0gLTE7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBjb25zb2xlLmxvZygncG9zc2libGUgcmFuZG9tIHZhbHVlcycsIHBvc3NpYmxlQXJyKTtcbiAgICAgICAgdmFyIG5ld1ZhbHVlID0gcG9zc2libGVBcnJbcG9zc2libGVBcnIubGVuZ3RoIC0gMV07XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdyYW5kb20gbmV3IHZhbHVlJywgbmV3VmFsdWUpO1xuICAgICAgICBpZiAobmV3VmFsdWUgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB2YWx1ZXMucHVzaChuZXdWYWx1ZSk7XG4gICAgICAgICAgICAkc2xpZGVyLnNsaWRlcignZGVzdHJveScpO1xuICAgICAgICAgICAgaW5pdFNsaWRlcigkc2xpZGVyLCB2YWx1ZXMpO1xuICAgICAgICAgICAgJHNsaWRlci5maW5kKCcudWktc2xpZGVyLWhhbmRsZTpsYXN0JykuZm9jdXMoKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGlzRnJvbURyYWcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBfbmV4dFNsaWRlciA9IGZpbmROZXh0U2xpZGVyKHNlbGVjdG9yLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgaWYgKCQoJy5mbGV4LWFjdGl2ZS1zbGlkZSAuZGVmYXVsdC13cmFwID4gZGl2JykuaW5kZXgoX25leHRTbGlkZXIpID09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhZGRIYW5kbGUoX25leHRTbGlkZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gZGVsZXRlSGFuZGxlKGhhbmRsZSkge1xuICAgIC8vIGNvbnNvbGUubG9nKGhhbmRsZSk7XG4gICAgdmFyICRzbGlkZXIgPSBoYW5kbGUucGFyZW50KCk7XG4gICAgdmFyIGhhbmRsZUluZGV4ID0gJHNsaWRlci5maW5kKCcudWktc2xpZGVyLWhhbmRsZScpLmluZGV4KGhhbmRsZSk7XG4gICAgdmFyIHZhbHVlcyA9ICRzbGlkZXIuc2xpZGVyKCd2YWx1ZXMnKTtcbiAgICAvLyBjb25zb2woJ29sZCB2YWx1ZXMnLCB2YWx1ZXMpO1xuICAgIC8vIGNvbnNvbChoYW5kbGVJbmRleCk7XG4gICAgdmFsdWVzLnNwbGljZShoYW5kbGVJbmRleCwgMSk7XG4gICAgLy8gY29uc29sKCduZXcgdmFsdWVzJywgdmFsdWVzKTtcbiAgICAkc2xpZGVyLnNsaWRlcignZGVzdHJveScpO1xuICAgIGluaXRTbGlkZXIoJHNsaWRlciwgdmFsdWVzKTtcbn1cblxuZnVuY3Rpb24gc2V0V2Vla1RleHQoc2xpZGVJbmRleCkge1xuICAgIHZhciBzdGFydE0gPSBzdGFydE1vbWVudC5jbG9uZSgpO1xuICAgIHZhciBtID0gc2xpZGVJbmRleCA/IHN0YXJ0TS5hZGQoc2xpZGVJbmRleCwgJ3cnKSA6IHN0YXJ0TTtcbiAgICB2YXIgbW9uZGF5ID0gbS5pc29XZWVrZGF5KDEpLmZvcm1hdCgnREQnKTtcbiAgICB2YXIgc3VuZGF5ID0gbS5pc29XZWVrZGF5KDcpLmZvcm1hdCgnREQnKTtcbiAgICB2YXIgdGhpc01vbnRoID0gbS5mb3JtYXQoJ01NJyk7XG4gICAgJCgnLml0ZW0td2VlaycpLmh0bWwoJ1dlZWsgJyArIG1vbmRheSArICctJyArIHN1bmRheSArICcuJyArIHRoaXNNb250aCk7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUFsbEhhbmRsZXMoKSB7XG4gICAgdmFyIGNhbGN1bGF0ZWRNb21lbnRzID0gW107IC8vIGZpbmFsIGFycmF5XG4gICAgY29uc29sZS5sb2coJ2NhbGN1bGF0aW5nIG1vbWVudHMuLi4nKTtcbiAgICB2YXIgYWxsRmxleFNsaWRlcyA9ICQoJy5mbGV4c2xpZGVyIC5zbGlkZXMgLml0ZW06bm90KC5jbG9uZSknKTtcbiAgICBhbGxGbGV4U2xpZGVzLmVhY2goZnVuY3Rpb24gKGksIHNsaWRlKSB7XG4gICAgICAgIHZhciB3ZWVrID0gc3RhcnRNb21lbnQud2VlaygpICsgaTtcbiAgICAgICAgdmFyIGFsbFdlZWtTbGlkZXJzID0gJChzbGlkZSkuZmluZCgnLmRlZmF1bHQtd3JhcCA+IGRpdicpO1xuICAgICAgICBhbGxXZWVrU2xpZGVycy5lYWNoKGZ1bmN0aW9uIChpLCBzbGlkZXIpIHtcbiAgICAgICAgICAgIHZhciBkYXkgPSAxICsgaTtcbiAgICAgICAgICAgIGlmICgkKHNsaWRlcikuaGFzQ2xhc3MoJ2FjdGl2ZS1zbGlkZXInKSkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZXMgPSAkKHNsaWRlcikuc2xpZGVyKCd2YWx1ZXMnKTtcbiAgICAgICAgICAgICAgICB2YXIgaG91cnMgPSB2YWx1ZXMubWFwKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjMgLSBlbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBob3Vycy5mb3JFYWNoKGZ1bmN0aW9uIChob3VyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGN1bGF0ZWRNb21lbnRzLnB1c2gobW9tZW50KCkueWVhcihzdGFydE1vbWVudC55ZWFyKCkpLm1vbnRoKHN0YXJ0TW9tZW50Lm1vbnRoKCkpLndlZWsod2VlaykuZGF5KGRheSkuaG91cihob3VyKS5taW51dGUoMCkuc2Vjb25kKDApKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgLy8gYWRkaXRpb25hbCB2YWxpZGF0aW5nLCBpbmNhc2UgaGFuZGxlcyB3ZW50IHRvIHBhc3QgZGF5cy9ob3Vyc1xuICAgIGNhbGN1bGF0ZWRNb21lbnRzID0gY2FsY3VsYXRlZE1vbWVudHMuZmlsdGVyKGZ1bmN0aW9uIChtb20pIHtcbiAgICAgICAgdmFyIGNhbnRHb1Bhc3QgPSBzdGFydE1vbWVudC5jbG9uZSgpLmhvdXIoc3RhcnRIb3VyICsgMSkubWludXRlKDApLnNlY29uZCgwKTtcbiAgICAgICAgcmV0dXJuIG1vbS51bml4KCkgPj0gY2FudEdvUGFzdC51bml4KCk7XG4gICAgfSk7XG5cbiAgICB2YXIgaW5Db25zb2xlID0gY2FsY3VsYXRlZE1vbWVudHMubWFwKGZ1bmN0aW9uIChtb20pIHtcbiAgICAgICAgcmV0dXJuIG1vbS5mb3JtYXQoJ0xMTCcpO1xuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2coaW5Db25zb2xlKTtcbiAgICBjb25zb2xlLmxvZygnb2JqZWN0IHJldHVybmVkIC0+ICcsIGNhbGN1bGF0ZWRNb21lbnRzKTtcbn1cblxufSx7fV19LHt9LFsxXSk7XG4iXX0=
